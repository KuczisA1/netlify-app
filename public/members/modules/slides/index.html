<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ChemDisk – Slides</title>
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <style>
    html,body{height:100%;margin:0}
    .stage{position:fixed;inset:0}
    iframe{width:100%;height:100%;border:0;display:block}
    .error{display:grid;place-items:center;height:100%;font:16px/1.4 system-ui,sans-serif;padding:24px;text-align:center}
    .error h1{margin:0 0 8px;font-size:20px}
    code{background:#f3f4f6;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <div id="stage" class="stage"><noscript>Włącz JavaScript, aby wczytać prezentację.</noscript></div>

  <script>
  (async () => {
    const stage = document.getElementById('stage');
    const qs = new URLSearchParams(window.location.search);
    const key = (qs.get('id') || '').trim();

    // Schowaj parametry po odczycie (czyściej, mniej „śladów”).
    if (key) history.replaceState(null, '', window.location.pathname);

    const endpoint = '/.netlify/functions/slides-key' + (key ? `?id=${encodeURIComponent(key)}` : '');

    try {
      const resp = await fetch(endpoint, { cache: 'no-store' });
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const data = await resp.json();
      if (!data.embedUrl) throw new Error('Brak embedUrl z funkcji.');

      const iframe = document.createElement('iframe');
      iframe.allowFullscreen = true;
      iframe.referrerPolicy = 'strict-origin-when-cross-origin';
      // Minimalne uprawnienia (nie zablokuje pobierania w 100%, ale ogranicza):
      iframe.sandbox = 'allow-scripts allow-same-origin allow-presentation';
      iframe.src = data.embedUrl; // już zbudowany /embed + rm=minimal
      stage.innerHTML = '';
      stage.appendChild(iframe);
    } catch (e) {
      stage.innerHTML = `
        <div class="error">
          <div>
            <h1>Nie udało się załadować prezentacji</h1>
            <p>${e.message}</p>
            <p>Ustaw <code>SLIDES_ID</code> (domyślna) lub np. <code>SLIDES_PREZENTACJA1</code> i wejdź przez <code>?id=PREZENTACJA1</code>.</p>
          </div>
        </div>`;
      console.error(e);
    }
  })();
  </script>
</body>
</html>
